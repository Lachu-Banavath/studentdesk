<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>StudentDesk | Exam Papers & Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body { background: #f5f7fb; color: #111827; }
    a { text-decoration: none; color: inherit; }

    .navbar { width: 100%; padding: 16px 5%; background: #ffffff; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08); }
    .nav-logo { font-size: 22px; font-weight: 700; color: #2563eb; }
    .nav-logo span { color: #111827; }
    .nav-links { display: flex; gap: 20px; font-size: 14px; font-weight: 500; }
    .nav-links a { padding: 6px 10px; border-radius: 999px; transition: background 0.2s; }
    .nav-links a:hover { background: #e5edff; }
    .nav-actions { display:flex; gap:10px; align-items:center; font-size: 13px; }

    .nav-actions button { border: none; outline: none; padding: 6px 14px; border-radius: 999px; cursor: pointer; font-size: 13px; font-weight: 500; }
    .btn-outline { border: 1px solid #d1d5db; background: #ffffff; }
    .btn-primary { background: #2563eb; color: #ffffff; box-shadow: 0 10px 20px rgba(37, 99, 235, 0.25); }

    .hero { padding: 40px 5% 24px; display: grid; grid-template-columns: 1.5fr 1fr; gap: 32px; align-items: center; }
    .hero-text h1 { font-size: 32px; line-height: 1.3; margin-bottom: 12px; }
    .hero-text h1 span { color: #2563eb; }
    .hero-text p { font-size: 14px; color: #4b5563; margin-bottom: 18px; }
    .hero-highlights { display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 18px; font-size: 12px; }
    .badge { padding: 6px 12px; border-radius: 999px; background: #e0f2fe; color: #0369a1; font-weight: 500; }
    .badge-secondary { background: #e5e7eb; color: #374151; }

    .search-container { margin-bottom: 18px; background: #ffffff; padding: 8px; border-radius: 999px; display: flex; align-items: center; gap: 8px; box-shadow: 0 6px 20px rgba(15, 23, 42, 0.08); }
    .search-container input { flex: 1; border: none; outline: none; font-size: 14px; padding: 8px 10px; border-radius: 999px; }
    .search-container button { border: none; outline: none; padding: 8px 16px; border-radius: 999px; background: #2563eb; color: #ffffff; font-size: 14px; font-weight: 500; cursor: pointer; }

    .hero-buttons { display: flex; gap: 10px; margin-top: 8px; }
    .hero-buttons .btn-secondary { border-radius: 999px; border: 1px solid #d1d5db; background: #ffffff; padding: 8px 16px; font-size: 14px; cursor: pointer; }

    .hero-card { background: linear-gradient(135deg, #2563eb, #1d4ed8); border-radius: 24px; color: #ffffff; padding: 22px 20px; box-shadow: 0 18px 40px rgba(37, 99, 235, 0.45); }
    .hero-card h2 { font-size: 18px; margin-bottom: 6px; }
    .hero-card p { font-size: 13px; color: #e5e7eb; margin-bottom: 16px; }
    .hero-stats { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 18px; }
    .hero-stat-number { font-size: 20px; font-weight: 700; }
    .hero-card-tag { font-size: 11px; padding: 6px 10px; border-radius: 999px; background: rgba(15, 23, 42, 0.3); display: inline-block; margin-bottom: 8px; }

    .filters { padding: 8px 5% 0; display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 12px; }
    .filter-group { display: flex; flex-direction: column; gap: 4px; font-size: 12px; }
    .filter-group label { color: #4b5563; }
    .filter-group select { padding: 8px 10px; border-radius: 10px; border: 1px solid #d1d5db; background: #ffffff; font-size: 13px; outline: none; }

    .content { padding: 24px 5% 40px; display: grid; grid-template-columns: 2fr 1.2fr; gap: 24px; align-items: flex-start; }
    .section-title { font-size: 16px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
    .section-title span { font-size: 12px; color: #2563eb; cursor: pointer; }

    .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }
    .paper-card, .note-card { background: #ffffff; border-radius: 16px; padding: 12px 12px 10px; box-shadow: 0 4px 14px rgba(15, 23, 42, 0.06); font-size: 12px; display: flex; flex-direction: column; gap: 6px; }
    .paper-title { font-weight: 600; font-size: 13px; }
    .paper-meta { display: flex; flex-wrap: wrap; gap: 6px; font-size: 11px; color: #6b7280; }

    .tag { padding: 3px 8px; border-radius: 999px; background: #eff6ff; color: #1d4ed8; font-size: 10px; }
    .download-row { display: flex; justify-content: space-between; align-items: center; margin-top: 6px; }
    .download-row button { border: none; outline: none; padding: 6px 10px; border-radius: 999px; background: #2563eb; color: #ffffff; font-size: 11px; cursor: pointer; }
    .download-count { font-size: 11px; color: #6b7280; }

    .sidebar-section { background: #ffffff; border-radius: 18px; padding: 16px; box-shadow: 0 4px 14px rgba(15, 23, 42, 0.06); margin-bottom: 16px; }
    .sidebar-section h3 { font-size: 14px; margin-bottom: 10px; }
    .list-item { font-size: 12px; padding: 6px 0; border-bottom: 1px solid #f3f4f6; display: flex; justify-content: space-between; align-items: center; }
    .list-item:last-child { border-bottom: none; }
    .pill { font-size: 10px; padding: 3px 8px; border-radius: 999px; background: #e5e7eb; }

    .footer { padding: 16px 5% 24px; border-top: 1px solid #e5e7eb; font-size: 11px; color: #6b7280; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 8px; }
    .footer a { margin-right: 10px; font-size: 11px; }

    @media (max-width: 900px) {
      .hero { grid-template-columns: 1fr; }
      .content { grid-template-columns: 1fr; }
      .filters { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .nav-links { display: none; }
    }
    @media (max-width: 600px) {
      .filters { grid-template-columns: 1fr; }
      .hero-text h1 { font-size: 24px; }
    }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <header class="navbar">
    <div class="nav-logo">Student<span>Desk</span></div>
    <nav class="nav-links">
      <a href="/">Home</a>
      <a href="/papers">Exam Papers</a>
      <a href="/notes">Notes</a>
      <a href="/about">About</a>
      <a href="/contact">Contact</a>
      <a href="/upload">Upload</a>
    </nav>
    <div class="nav-actions">
      <% if (student) { %>
        <span>Hi, <%= student.name %> (<%= student.rollNo %>)</span>
        <form method="POST" action="/student/logout" style="display:inline;">
          <button type="submit" class="btn-outline">Logout</button>
        </form>
      <% } else { %>
        <a href="/student/login"><button type="button" class="btn-outline">Student Login</button></a>
      <% } %>

      <% if (isAdmin) { %>
        <form method="POST" action="/admin/logout" style="display:inline;">
          <button type="submit" class="btn-primary">Admin Logout</button>
        </form>
      <% } else { %>
        <a href="/admin/login"><button type="button" class="btn-primary">Admin Login</button></a>
      <% } %>
    </div>
  </header>

  <!-- HERO SECTION -->
  <section class="hero">
    <div class="hero-text">
      <h1>All your <span>College Exam Papers</span> & Notes in one place.</h1>
      <p>Download previous year question papers, important PDFs, and high-quality notes for every branch and year.</p>

      <div class="hero-highlights">
        <div class="badge">‚úî Previous Year Papers</div>
        <div class="badge badge-secondary">‚úî Unit-wise Notes</div>
        <div class="badge badge-secondary">‚úî Branch & Year Filter</div>
      </div>

      <!-- Search form -->
      <form class="search-container" method="GET" action="/">
        <input
          type="text"
          name="q"
          placeholder="Search e.g. 'DBMS CSE 2nd year 2024'"
          value="<%= filters.q || '' %>"
        />
        <button type="submit">Search</button>
      </form>

      <div class="hero-buttons">
        <button class="btn-primary" type="submit" form="filtersForm">Browse Exam Papers</button>
        <button class="btn-secondary" type="submit" form="filtersForm">View Notes Library</button>
      </div>
    </div>

    <div class="hero-card">
      <span class="hero-card-tag">Quick Stats</span>
      <h2>Smart study starts here.</h2>
      <p>Access curated exam papers and notes uploaded by toppers and faculty.</p>

      <div class="hero-stats">
        <div>
          <div class="hero-stat-number"><%= papers.length %>+</div>
          <div>Question Papers</div>
        </div>
        <div>
          <div class="hero-stat-number"><%= notes.length %>+</div>
          <div>Notes PDFs</div>
        </div>
        <div>
          <div class="hero-stat-number">30+</div>
          <div>Subjects</div>
        </div>
      </div>

      <p style="font-size: 11px;">Tip: Start by selecting your branch & year below to see relevant papers.</p>
    </div>
  </section>

  <!-- FILTERS -->
  <form class="filters" id="filtersForm" method="GET" action="/">
    <input type="hidden" name="q" value="<%= filters.q || '' %>">

    <div class="filter-group">
      <label for="branch">Branch</label>
      <% const b = filters.branch || ""; %>
      <select id="branch" name="branch">
        <option value="">Select branch</option>
        <option value="CSE" <%= b === "CSE" ? "selected" : "" %>>CSE</option>
        <option value="ECE" <%= b === "ECE" ? "selected" : "" %>>ECE</option>
        <option value="EEE" <%= b === "EEE" ? "selected" : "" %>>EEE</option>
        <option value="CIVIL" <%= b === "CIVIL" ? "selected" : "" %>>CIVIL</option>
        <option value="CSE Cyber Security" <%= b === "CSE Cyber Security" ? "selected" : "" %>>CSE Cyber Security</option>
        <option value="CSE Data Science" <%= b === "CSE Data Science" ? "selected" : "" %>>CSE Data Science</option>
        <option value="AIML" <%= b === "AIML" ? "selected" : "" %>>AIML</option>
        <option value="IoT" <%= b === "IoT" ? "selected" : "" %>>IoT</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="year">Year</label>
      <% const y = filters.year || ""; %>
      <select id="year" name="year">
        <option value="">Select year</option>
        <option value="1st Year" <%= y === "1st Year" ? "selected" : "" %>>1st Year</option>
        <option value="2nd Year" <%= y === "2nd Year" ? "selected" : "" %>>2nd Year</option>
        <option value="3rd Year" <%= y === "3rd Year" ? "selected" : "" %>>3rd Year</option>
        <option value="4th Year" <%= y === "4th Year" ? "selected" : "" %>>4th Year</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="sem">Semester</label>
      <% const s = filters.sem || ""; %>
      <select id="sem" name="sem">
        <option value="">Select semester</option>
        <% for (let i = 1; i <= 8; i++) {
             const label = "Semester " + i;
        %>
          <option value="<%= label %>" <%= s === label ? "selected" : "" %>><%= label %></option>
        <% } %>
      </select>
    </div>

    <div class="filter-group">
      <label for="examType">Exam Type</label>
      <% const eType = filters.examType || ""; %>
      <select id="examType" name="examType">
        <option value="">All</option>
        <option value="Mid Exam" <%= eType === "Mid Exam" ? "selected" : "" %>>Mid Exam</option>
        <option value="Semester Final" <%= eType === "Semester Final" ? "selected" : "" %>>Semester Final</option>
        <option value="Lab External" <%= eType === "Lab External" ? "selected" : "" %>>Lab External</option>
        <option value="Unit Test" <%= eType === "Unit Test" ? "selected" : "" %>>Unit Test</option>
      </select>
    </div>
  </form>

  <!-- MAIN CONTENT -->
  <main class="content">
    <div>
      <div class="section-title" id="papers">
        <h2>Latest Question Papers</h2>
        <span onclick="document.getElementById('filtersForm').submit()">View all ‚Üí</span>
      </div>
      <div class="card-grid">
        <% if (papers.length === 0) { %>
          <p style="font-size: 12px; color:#6b7280;">No question papers found for this filter.</p>
        <% } %>
        <% papers.forEach(function(p) { %>
          <div class="paper-card">
            <div class="paper-title"><%= p.title %></div>
            <div class="paper-meta">
              <% if (p.regulation) { %>
                <span>Regulation: <%= p.regulation %></span>
              <% } %>
              <% if (p.examType) { %>
                <span>Exam: <%= p.examType %></span>
              <% } %>
            </div>
            <div class="paper-meta">
              <% if (p.branch) { %><span class="tag"><%= p.branch %></span><% } %>
              <% if (p.semester) { %><span class="tag"><%= p.semester %></span><% } %>
            </div>
            <div class="download-row">
              <div class="download-count">
                üìÑ PDF
                <% if (p.size) { %> ‚Ä¢ <%= p.size %><% } %>
                ‚Ä¢ <%= p.downloads || 0 %> downloads
              </div>
              <% if (p.fileUrl) { %>
                <a href="/download/<%= p._id %>" target="_blank">
                  <button type="button">Download</button>
                </a>
              <% } else { %>
                <button type="button" disabled>Not available</button>
              <% } %>
            </div>
            <% if (isAdmin) { %>
              <form method="POST" action="/delete/<%= p._id %>" style="margin-top:6px;">
                <button type="submit"
                  onclick="return confirm('Delete this resource permanently?')"
                  style="background:#dc2626; color:#fff; border:none; padding:5px 10px; border-radius:8px; font-size:11px; cursor:pointer;">
                  Delete
                </button>
              </form>
            <% } %>
          </div>
        <% }) %>
      </div>

      <div style="margin-top: 22px;" class="section-title" id="notes">
        <h2>Top Notes PDFs</h2>
        <span onclick="document.getElementById('filtersForm').submit()">View all ‚Üí</span>
      </div>

      <div class="card-grid">
        <% if (notes.length === 0) { %>
          <p style="font-size: 12px; color:#6b7280;">No notes found for this filter.</p>
        <% } %>
        <% notes.forEach(function(n) { %>
          <div class="note-card">
            <div class="paper-title"><%= n.title %></div>
            <div class="paper-meta">
              <% if (n.uploader) { %>
                <span>Uploaded by: <%= n.uploader %></span>
              <% } %>
              <% if (n.rating) { %>
                <span>Rating: ‚≠ê<%= "‚òÖ".repeat(Math.max(0, Math.round(n.rating) - 1)) %></span>
              <% } %>
            </div>
            <div class="paper-meta">
              <% if (n.branch) { %><span class="tag"><%= n.branch %></span><% } %>
              <% if (n.subject) { %><span class="tag"><%= n.subject %></span><% } %>
            </div>
            <div class="download-row">
              <div class="download-count">
                üìÑ PDF
                <% if (n.size) { %> ‚Ä¢ <%= n.size %><% } %>
                ‚Ä¢ <%= n.downloads || 0 %> downloads
              </div>
              <% if (n.fileUrl) { %>
                <a href="/download/<%= n._id %>" target="_blank">
                  <button type="button">Download</button>
                </a>
              <% } else { %>
                <button type="button" disabled>Not available</button>
              <% } %>
            </div>
            <% if (isAdmin) { %>
              <form method="POST" action="/delete/<%= n._id %>" style="margin-top:6px;">
                <button type="submit"
                  onclick="return confirm('Delete this resource permanently?')"
                  style="background:#dc2626; color:#fff; border:none; padding:5px 10px; border-radius:8px; font-size:11px; cursor:pointer;">
                  Delete
                </button>
              </form>
            <% } %>
          </div>
        <% }) %>
      </div>
    </div>

    <aside>
      <div class="sidebar-section">
        <h3>Recently Added</h3>
        <% if (recent.length === 0) { %>
          <p style="font-size: 12px; color:#6b7280;">No recent uploads yet.</p>
        <% } %>
        <% recent.forEach(function(r) { %>
          <div class="list-item">
            <span><%= r.subject || r.title %></span>
            <span class="pill"><%= r.type === "paper" ? "Paper" : "Notes" %></span>
          </div>
        <% }) %>
      </div>

      <div class="sidebar-section" id="syllabus">
        <h3>Quick Links</h3>
        <div class="list-item">
          <span>All CSE Papers</span>
          <span><a href="/branch/CSE">‚Üí</a></span>
        </div>
        <div class="list-item">
          <span>All ECE Papers</span>
          <span><a href="/branch/ECE">‚Üí</a></span>
        </div>
        <div class="list-item">
          <span>Model Question Papers</span>
          <span>‚Üí</span>
        </div>
        <div class="list-item">
          <span>Important Question Bank</span>
          <span>‚Üí</span>
        </div>
      </div>

      <div class="sidebar-section">
        <h3>Upload Section</h3>
        <p style="font-size: 11px; color: #4b5563; margin-bottom: 10px;">
          Help your juniors! Upload your exam papers or notes PDFs.
        </p>
        <a href="/upload">
          <button class="btn-primary" style="width: 100%; padding: 8px 0; font-size: 12px;">
            Upload Paper / Notes
          </button>
        </a>
      </div>
    </aside>
  </main>

  <footer class="footer" id="contact">
    <div>
      ¬© 2025 StudentDesk. For educational use only.
    </div>
    <div>
      <a href="/about">About</a>
      <a href="/contact">Contact</a>
      <a href="/papers">Papers</a>
      <a href="/notes">Notes</a>
    </div>
  </footer>

</body>
</html>
